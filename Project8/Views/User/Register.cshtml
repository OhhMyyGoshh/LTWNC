@model WebBanSach.Models.Data.KhachHang

@{
 ViewBag.Title = "Đăng ký";
 Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Đăng ký thành viên</h2>


@using (Html.BeginForm("Register", "User", FormMethod.Post))
{
	@Html.AntiForgeryToken()
	if (ViewBag.error != null)
	{
		<label style="color: red;">@ViewBag.error</label>
	}
	<div class="form-horizontal">
		<hr />
		@Html.ValidationSummary(true, "", new { @class = "text-danger" })
		<div class="form-group">
			@Html.LabelFor(model => model.TaiKhoan, htmlAttributes: new { @class = "control-label col-md-2" })
			<div class="col-md-10">
				@Html.EditorFor(model => model.TaiKhoan, new { htmlAttributes = new { @class = "form-control" } })
				@Html.ValidationMessageFor(model => model.TaiKhoan, "", new { @class = "text-danger" })
			</div>
		</div>

		<div class="form-group">
			@Html.LabelFor(model => model.MatKhau, htmlAttributes: new { @class = "control-label col-md-2" })
			<div class="col-md-10">
				@Html.EditorFor(model => model.MatKhau, new { htmlAttributes = new { @class = "form-control" } })
				@Html.ValidationMessageFor(model => model.MatKhau, "", new { @class = "text-danger" })
			</div>
		</div>
		<div class="form-group">
			<label class="control-label col-md-2" for="RePassword">Nhập lại mật khẩu</label>
			<div class="col-md-10">
				<input type="password" name="RePassword" id="RePassword" class="form-control" required placeholder="Nhập lại mật khẩu" />
				<span class="text-danger" id="RePasswordError"></span>
			</div>
		</div>

		<div class="form-group">
			@Html.LabelFor(model => model.TenKH, htmlAttributes: new { @class = "control-label col-md-2" })
			<div class="col-md-10">
				@Html.EditorFor(model => model.TenKH, new { htmlAttributes = new { @class = "form-control" } })
				@Html.ValidationMessageFor(model => model.TenKH, "", new { @class = "text-danger" })
			</div>
		</div>

		<div class="form-group">
			@Html.LabelFor(model => model.Email, htmlAttributes: new { @class = "control-label col-md-2" })
			<div class="col-md-10">
				@Html.EditorFor(model => model.Email, new { htmlAttributes = new { @class = "form-control" } })
				@Html.ValidationMessageFor(model => model.Email, "", new { @class = "text-danger" })
			</div>
		</div>

		<div class="form-group">
			@Html.LabelFor(model => model.DiaChi, htmlAttributes: new { @class = "control-label col-md-2" })
			<div class="col-md-10">
				@Html.EditorFor(model => model.DiaChi, new { htmlAttributes = new { @class = "form-control" } })
				@Html.ValidationMessageFor(model => model.DiaChi, "", new { @class = "text-danger" })
			</div>
		</div>

		<div class="form-group">
			@Html.LabelFor(model => model.DienThoai, htmlAttributes: new { @class = "control-label col-md-2" })
			<div class="col-md-10">
				@Html.EditorFor(model => model.DienThoai, new { htmlAttributes = new { @class = "form-control" } })
				@Html.ValidationMessageFor(model => model.DienThoai, "", new { @class = "text-danger" })
			</div>
		</div>

		<div class="form-group">
			@Html.LabelFor(model => model.NgaySinh, htmlAttributes: new { @class = "control-label col-md-2" })
			<div class="col-md-10">
				@Html.EditorFor(model => model.NgaySinh, new { htmlAttributes = new { @class = "form-control", @type = "date" } })
				@Html.ValidationMessageFor(model => model.NgaySinh, "", new { @class = "text-danger" })
			</div>
		</div>

		<div class="form-group">
			<div class="col-md-offset-2 col-md-10">
				<input style="background-color:#0094ff; border:none;" type="submit" value="Đăng ký" class="btn btn-primary" />
			</div>
		</div>
	</div>
}

@Html.Raw(@"<script>
document.querySelector('form').onsubmit = function(e) {
	var valid = true;
	// Tài khoản: 4-50 ký tự, không ký tự đặc biệt
	var tk = document.getElementById('TaiKhoan') ? document.getElementById('TaiKhoan').value : document.getElementsByName('TaiKhoan')[0].value;
	if (!/^\\w{4,50}$/.test(tk)) {
		showError('TaiKhoan', 'Tài khoản phải từ 4-50 ký tự, chỉ gồm chữ, số, dấu gạch dưới.');
		valid = false;
	} else {
		showError('TaiKhoan', '');
	}
	// Tên: 2-50 ký tự, không số, không ký tự đặc biệt
	var ten = document.getElementById('TenKH') ? document.getElementById('TenKH').value : document.getElementsByName('TenKH')[0].value;
	if (!/^[a-zA-ZÀ-ỹ\\s]{2,50}$/.test(ten)) {
		showError('TenKH', 'Tên chỉ gồm chữ cái, không chứa số/ký tự đặc biệt, 2-50 ký tự.');
		valid = false;
	} else {
		showError('TenKH', '');
	}
	// Email
	var email = document.getElementById('Email') ? document.getElementById('Email').value : document.getElementsByName('Email')[0].value;
	if (!/^([\\w\\.-]+)@([\\w\\.-]+)\\.\\w{2,}$/.test(email)) {
		showError('Email', 'Email không hợp lệ.');
		valid = false;
	} else {
		showError('Email', '');
	}
	// Số điện thoại: 9-15 số
	var dt = document.getElementById('DienThoai') ? document.getElementById('DienThoai').value : document.getElementsByName('DienThoai')[0].value;
	if (!/^\\d{9,15}$/.test(dt)) {
		showError('DienThoai', 'Số điện thoại phải từ 9-15 số.');
		valid = false;
	} else {
		showError('DienThoai', '');
	}
	// Mật khẩu mạnh: >=8 ký tự, có chữ hoa, thường, số, ký tự đặc biệt
	var mk = document.getElementById('MatKhau') ? document.getElementById('MatKhau').value : document.getElementsByName('MatKhau')[0].value;
	if (mk.length < 8 || !/[A-Z]/.test(mk) || !/[a-z]/.test(mk) || !/\\d/.test(mk) || !/[^a-zA-Z0-9]/.test(mk)) {
		showError('MatKhau', 'Mật khẩu phải từ 8 ký tự, có chữ hoa, thường, số, ký tự đặc biệt.');
		valid = false;
	} else {
		showError('MatKhau', '');
	}
	// Nhập lại mật khẩu
	var remk = document.getElementById('RePassword').value;
	if (mk !== remk) {
		document.getElementById('RePasswordError').innerText = 'Mật khẩu nhập lại không khớp';
		valid = false;
	} else {
		document.getElementById('RePasswordError').innerText = '';
	}
	if (!valid) e.preventDefault();
};
function showError(field, msg) {
	var el = document.getElementsByName(field)[0];
	if (!el) return;
	var span = el.parentNode.querySelector('.text-danger');
	if (span) span.innerText = msg;
}
</script>")
